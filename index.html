<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>å¤–éƒ¨è©•åˆ†éª¨æ¶</title>
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Arial, sans-serif; margin: 16px; }
    .row { display: flex; gap: 16px; align-items: flex-start; }
    .col { border: 1px solid #ddd; border-radius: 10px; padding: 12px; }
    .left { width: 45%; min-width: 320px; }
    .right { width: 55%; min-width: 360px; }
    select, input, textarea, button { font-size: 14px; padding: 8px; }
    textarea { width: 100%; min-height: 90px; }
    .qitem { padding: 10px; border: 1px solid #eee; border-radius: 8px; margin-bottom: 8px; cursor: pointer; }
    .qitem:hover { background: #fafafa; }
    .qitem.active { border-color: #4f46e5; background: #eef2ff; }
    .label { font-size: 12px; color: #555; margin-top: 10px; margin-bottom: 4px; }
    .grid2 { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .hint { color: #666; font-size: 12px; margin-top: 8px; }
    .status { margin-top: 10px; }
  </style>
</head>
<body>

<h2>å¤–éƒ¨è©•åˆ†ï¼ˆäº’å‹•éª¨æ¶ç‰ˆï¼‰</h2>

<div class="label">åˆ†é¡</div>
<select id="category"></select>

<div class="row" style="margin-top: 12px;">
  <div class="col left">
    <div style="display:flex; justify-content:space-between; align-items:center;">
      <strong>é¡Œç›®æ¸…å–®</strong>
      <span class="hint">å…ˆç”¨å‡è³‡æ–™</span>
    </div>
    <div id="qList" style="margin-top: 10px;"></div>
  </div>

  <div class="col right">
    <strong>é¡Œç›®å…§å®¹</strong>

    <div class="label">é¡Œç›®</div>
    <div id="qText" style="white-space: pre-wrap; border:1px solid #eee; border-radius:8px; padding:10px; min-height:60px;"></div>

    <div class="label">ç­”æ¡ˆï¼ˆä¾›è©•åˆ†è€…åƒè€ƒï¼‰</div>
    <div id="aText" style="white-space: pre-wrap; border:1px solid #eee; border-radius:8px; padding:10px; min-height:60px;"></div>

    <div class="grid2">
      <div>
        <div class="label">å…§å®¹æ­£ç¢ºæ€§ Aï¼ˆ0~50ï¼‰</div>
        <input id="scoreA" type="number" min="0" max="50" step="1" placeholder="0~50" style="width:100%;" />
      </div>
      <div>
        <div class="label">èªæ„å®Œæ•´æ€§ Bï¼ˆ0~50ï¼‰</div>
        <input id="scoreB" type="number" min="0" max="50" step="1" placeholder="0~50" style="width:100%;" />
      </div>
    </div>

    <div class="label">æœ¬é¡è©•èªï¼ˆå¯ç©ºç™½ï¼‰</div>
    <textarea id="comment" placeholder="å¯ç•™ç©º"></textarea>

    <div style="margin-top: 12px; display:flex; gap:10px; align-items:center;">
      <button id="btnSave">å„²å­˜æœ¬é¡çµæœ</button>
      <button id="btnClear" type="button">æ¸…ç©ºæœ¬é¡Œè¼¸å…¥</button>
    </div>

    <div class="status" id="status"></div>
    <div class="hint">ç›®å‰å„²å­˜æ˜¯ã€Œæ¯æŒ‰ä¸€æ¬¡å°±æ–°å¢ä¸€ç­†ã€ï¼šåªæ˜¯å…ˆé©—è­‰äº’å‹•èˆ‡å¯«å…¥ã€‚ä¸‹ä¸€æ­¥å†æ”¹æˆã€ŒåŒä¸€äººåŒä¸€ç­†æ›´æ–°ã€ã€‚</div>
  </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
  import { getFirestore, doc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

  // âœ… ä½ çš„ Firebase è¨­å®š
  const firebaseConfig = {
    apiKey: "AIzaSyBqSDWpIR_Bm2CVdnObkkuopOBrxgoXlH0",
    authDomain: "tcswg-ai-qa.firebaseapp.com",
    projectId: "tcswg-ai-qa"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const EVAL_ID = "demo-eval-001"; // å…ˆå¯«æ­»ï¼šä¹‹å¾Œå†æ›æˆçœŸçš„åŒä¸€äºº/åŒä¸€å ´æ¬¡ id


  // âœ… åˆ†é¡ï¼ˆä½ æä¾›çš„ 5 é¡ï¼‰
  const CATEGORY_KEYS = {
    "åŒ–ç³æ± è™•ç†": "septic",
    "æ¥ç®¡æµç¨‹èˆ‡æœŸé™": "connection",
    "æ–½å·¥èˆ‡æŠ€è¡“": "construction",
    "è²»ç”¨èˆ‡è£œåŠ©": "subsidy",
    "æ”¿ç­–èˆ‡æ³•è¦": "policy"
  };

  // âœ… å‡é¡Œç›®è³‡æ–™ï¼šæ¯é¡ 3 é¡Œï¼ˆä¹‹å¾Œç”¨ 200 é¡Œè³‡æ–™å–ä»£é€™è£¡ï¼‰
  const QUESTIONS = {
    "åŒ–ç³æ± è™•ç†": [
      { id: "Q1-1", q: "ï¼ˆç¤ºç¯„ï¼‰åŒ–ç³æ± å¤šä¹…éœ€è¦æŠ½è‚¥ï¼Ÿ", a: "ä¾ä½¿ç”¨ç‹€æ³èˆ‡å®¹é‡ï¼Œé€šå¸¸å»ºè­°å®šæœŸå§”å¤–æ¸…é™¤ï¼Œä¸¦ä¾ä¸»ç®¡æ©Ÿé—œè¦å®šè¾¦ç†ã€‚" },
      { id: "Q1-2", q: "ï¼ˆç¤ºç¯„ï¼‰åŒ–ç³æ± æ¸…é™¤å¾Œæ±™æ³¥å»å“ªï¼Ÿ", a: "æ‡‰äº¤ç”±åˆæ³•æ¸…é‹/è™•ç†å–®ä½è™•ç†ï¼Œä¸å¾—ä»»æ„æ’æ”¾ã€‚" },
      { id: "Q1-3", q: "ï¼ˆç¤ºç¯„ï¼‰åŒ–ç³æ± å¯å¦ç›´æ¥æ”¹æ¥ä¸‹æ°´é“ï¼Ÿ", a: "éœ€ä¾æ¥ç®¡è¦å®šèˆ‡æ–½å·¥ç¨‹åºè¾¦ç†ï¼Œä¸¦é…åˆç¾å‹˜èˆ‡ç”³è«‹ã€‚" }
    ],
    "æ¥ç®¡æµç¨‹èˆ‡æœŸé™": [
      { id: "Q2-1", q: "ï¼ˆç¤ºç¯„ï¼‰ç”³è«‹æ¥ç®¡çš„æµç¨‹ï¼Ÿ", a: "é€šå¸¸åŒ…å«ç”³è«‹ã€ç¾å‹˜ã€è¨­è¨ˆ/æ–½å·¥ã€é©—æ”¶ç­‰éšæ®µï¼ˆä¾åœ°æ–¹è¦å®šç‚ºæº–ï¼‰ã€‚" },
      { id: "Q2-2", q: "ï¼ˆç¤ºç¯„ï¼‰æ¥ç®¡æœŸç¨‹å¤§æ¦‚å¤šä¹…ï¼Ÿ", a: "è¦–æ¡ˆä»¶é‡èˆ‡ç¾å ´æ¢ä»¶è€Œå®šï¼Œå¯èƒ½æ•¸é€±è‡³æ•¸æœˆã€‚" },
      { id: "Q2-3", q: "ï¼ˆç¤ºç¯„ï¼‰ä¸€å®šè¦æ¥å—ï¼Ÿ", a: "ä¾æ”¿ç­–èˆ‡æ³•è¦åŠä¸»ç®¡æ©Ÿé—œå…¬å‘Šç¯„åœè¦å®šã€‚" }
    ],
    "æ–½å·¥èˆ‡æŠ€è¡“": [
      { id: "Q3-1", q: "ï¼ˆç¤ºç¯„ï¼‰æ–½å·¥æœƒé–‹æŒ–å¤šä¹…ï¼Ÿ", a: "è¦–è·¯æ®µã€ç®¡ç·šè¤‡é›œåº¦èˆ‡å·¥åºè€Œå®šã€‚" },
      { id: "Q3-2", q: "ï¼ˆç¤ºç¯„ï¼‰é‡åˆ°éšœç¤™ç‰©æ€éº¼è™•ç†ï¼Ÿ", a: "ä¾ç¾å‹˜èˆ‡è¨­è¨ˆèª¿æ•´ï¼Œå¿…è¦æ™‚æ¡æ›¿ä»£å·¥æ³•æˆ–æ”¹ç·šã€‚" },
      { id: "Q3-3", q: "ï¼ˆç¤ºç¯„ï¼‰æ–½å·¥å½±éŸ¿å‹•ç·šï¼Ÿ", a: "é€šå¸¸æœƒå…¬å‘Šã€äº¤ç¶­èˆ‡åˆ†æ®µæ–½å·¥é™ä½å½±éŸ¿ã€‚" }
    ],
    "è²»ç”¨èˆ‡è£œåŠ©": [
      { id: "Q4-1", q: "ï¼ˆç¤ºç¯„ï¼‰æ¥ç®¡è²»ç”¨èª°å‡ºï¼Ÿ", a: "ä¾è£œåŠ©æ–¹æ¡ˆèˆ‡ç”³è«‹è³‡æ ¼ï¼Œæœ‰äº›é …ç›®å¯ç”³è«‹è£œåŠ©æˆ–æ¸›å…ã€‚" },
      { id: "Q4-2", q: "ï¼ˆç¤ºç¯„ï¼‰æœ‰å“ªäº›è£œåŠ©ï¼Ÿ", a: "ä¾åœ°æ–¹æ”¿åºœå…¬å‘Šèˆ‡å¹´åº¦è¨ˆç•«ç‚ºæº–ã€‚" },
      { id: "Q4-3", q: "ï¼ˆç¤ºç¯„ï¼‰ä¸é…åˆæœƒç½°å—ï¼Ÿ", a: "ä¾ç›¸é—œæ³•è¦è¦å®šåŠä¸»ç®¡æ©Ÿé—œè£è™•ã€‚" }
    ],
    "æ”¿ç­–èˆ‡æ³•è¦": [
      { id: "Q5-1", q: "ï¼ˆç¤ºç¯„ï¼‰å“ªäº›å€åŸŸæ˜¯å¼·åˆ¶æ¥ç®¡ï¼Ÿ", a: "ä¾ä¸»ç®¡æ©Ÿé—œå…¬å‘Šæ¥ç®¡ç¯„åœèˆ‡æ³•è¦è¦æ±‚ã€‚" },
      { id: "Q5-2", q: "ï¼ˆç¤ºç¯„ï¼‰æ³•æºä¾æ“šæœ‰å“ªäº›ï¼Ÿ", a: "ä¾æ±¡æ°´ä¸‹æ°´é“ç›¸é—œæ³•è¦ã€åœ°æ–¹è‡ªæ²»æ¢ä¾‹èˆ‡å…¬å‘Šç‚ºæº–ã€‚" },
      { id: "Q5-3", q: "ï¼ˆç¤ºç¯„ï¼‰æ°‘çœ¾æ¬Šç›Šèˆ‡ç”³è¨´ç®¡é“ï¼Ÿ", a: "å¯å‘ä¸»ç®¡æ©Ÿé—œæ´½è©¢æˆ–ä¾ç”³è¨´æµç¨‹è¾¦ç†ã€‚" }
    ]
  };

  // --- UI ç‹€æ…‹ ---
  let currentCategory = CATEGORIES[0];
  let currentQuestion = QUESTIONS[currentCategory][0];

  const elCat = document.getElementById("category");
  const elList = document.getElementById("qList");
  const elQ = document.getElementById("qText");
  const elA = document.getElementById("aText");
  const elScoreA = document.getElementById("scoreA");
  const elScoreB = document.getElementById("scoreB");
  const elComment = document.getElementById("comment");
  const elStatus = document.getElementById("status");

  function setStatus(msg, ok=true) {
    elStatus.innerHTML = ok ? `<span style="color:green;">âœ… ${msg}</span>` : `<span style="color:#b91c1c;">âŒ ${msg}</span>`;
  }

  function renderCategoryOptions() {
    elCat.innerHTML = CATEGORIES.map(c => `<option value="${c}">${c}</option>`).join("");
    elCat.value = currentCategory;
  }

  function renderQuestionList() {
    const qs = QUESTIONS[currentCategory] || [];
    elList.innerHTML = "";
    qs.forEach(q => {
      const div = document.createElement("div");
      div.className = "qitem" + (q.id === currentQuestion?.id ? " active" : "");
      div.innerHTML = `<div><strong>${q.id}</strong></div><div style="margin-top:4px; white-space:pre-wrap;">${q.q}</div>`;
      div.onclick = () => {
        currentQuestion = q;
        renderQuestionList();
        renderQuestionContent();
        setStatus("å·²åˆ‡æ›é¡Œç›®ï¼ˆå°šæœªå„²å­˜ï¼‰", true);
      };
      elList.appendChild(div);
    });
  }

  function renderQuestionContent() {
    elQ.textContent = currentQuestion?.q || "";
    elA.textContent = currentQuestion?.a || "";
  }

  function clearInputs() {
    elScoreA.value = "";
    elScoreB.value = "";
    elComment.value = "";
  }

  function validateScores() {
    // å…è¨±ç©ºç™½å…ˆä¸ç®¡ï¼Œäº’å‹•éª¨æ¶å…ˆè·‘é€šï¼›ä¸‹ä¸€æ­¥å†åŠ åš´æ ¼è¦å‰‡
    const a = elScoreA.value === "" ? null : Number(elScoreA.value);
    const b = elScoreB.value === "" ? null : Number(elScoreB.value);

    if (a !== null && (Number.isNaN(a) || a < 0 || a > 50)) return { ok:false, msg:"A å¿…é ˆæ˜¯ 0~50" };
    if (b !== null && (Number.isNaN(b) || b < 0 || b > 50)) return { ok:false, msg:"B å¿…é ˆæ˜¯ 0~50" };
    return { ok:true, a, b };
  }

  // --- äº‹ä»¶ ---
  elCat.addEventListener("change", () => {
    currentCategory = elCat.value;
    currentQuestion = QUESTIONS[currentCategory][0];
    renderQuestionList();
    renderQuestionContent();
    clearInputs();
    setStatus("å·²åˆ‡æ›åˆ†é¡ï¼ˆè¼¸å…¥å·²æ¸…ç©ºï¼‰", true);
  });

  document.getElementById("btnClear").addEventListener("click", () => {
    clearInputs();
    setStatus("å·²æ¸…ç©ºæœ¬é¡Œè¼¸å…¥", true);
  });

  document.getElementById("btnSave").addEventListener("click", async () => {
    if (!currentQuestion) {
      setStatus("æ²’æœ‰é¸åˆ°é¡Œç›®", false);
      return;
    }
    const v = validateScores();
    if (!v.ok) {
      setStatus(v.msg, false);
      return;
    }

    try {
      const catKey = CATEGORY_KEYS[currentCategory];
    
      await setDoc(doc(db, "scores", EVAL_ID), {
        evalId: EVAL_ID,
        updatedAt: serverTimestamp(),
    
        // ğŸ‘‡ é€™äº›æœƒå¯«åˆ° categories.xxx åº•ä¸‹
        [`categories.${catKey}.category`]: currentCategory,
        [`categories.${catKey}.questionId`]: currentQuestion.id,
        [`categories.${catKey}.questionText`]: currentQuestion.q,
        [`categories.${catKey}.answerRef`]: currentQuestion.a,
        [`categories.${catKey}.scoreA`]: v.a,
        [`categories.${catKey}.scoreB`]: v.b,
        [`categories.${catKey}.comment`]: elComment.value || "",
        [`categories.${catKey}.updatedAt`]: serverTimestamp()
    
      }, { merge: true });



      setStatus("å·²å„²å­˜ï¼ˆå·²å¯«å…¥ Firestoreï¼‰", true);
    } catch (err) {
      console.error(err);
      setStatus("å¯«å…¥å¤±æ•—ï¼Œè«‹çœ‹ Console", false);
    }
  });

  // --- åˆå§‹åŒ– ---
  renderCategoryOptions();
  renderQuestionList();
  renderQuestionContent();
  setStatus("å·²è¼‰å…¥ï¼ˆå…ˆç”¨å‡è³‡æ–™ï¼‰", true);

</script>
</body>
</html>
